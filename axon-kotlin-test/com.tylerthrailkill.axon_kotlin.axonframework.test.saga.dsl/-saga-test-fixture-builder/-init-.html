<HTML>
<HEAD>
<meta charset="UTF-8">
<title>SagaTestFixtureBuilder.<init> - axon-kotlin-test</title>
<link rel="stylesheet" href="../../../style.css">
</HEAD>
<BODY>
<a href="../../index.html">axon-kotlin-test</a>&nbsp;/&nbsp;<a href="../index.html">com.tylerthrailkill.axon_kotlin.axonframework.test.saga.dsl</a>&nbsp;/&nbsp;<a href="index.html">SagaTestFixtureBuilder</a>&nbsp;/&nbsp;<a href="./-init-.html">&lt;init&gt;</a><br/>
<br/>
<h1>&lt;init&gt;</h1>
<a name="com.tylerthrailkill.axon_kotlin.axonframework.test.saga.dsl.SagaTestFixtureBuilder$&lt;init&gt;(org.axonframework.test.saga.FixtureConfiguration)"></a>
<code><span class="identifier">SagaTestFixtureBuilder</span><span class="symbol">(</span><span class="identifier" id="com.tylerthrailkill.axon_kotlin.axonframework.test.saga.dsl.SagaTestFixtureBuilder$<init>(org.axonframework.test.saga.FixtureConfiguration)/sagaTestFixture">sagaTestFixture</span><span class="symbol">:</span>&nbsp;<span class="identifier">FixtureConfiguration</span><span class="symbol">)</span></code><pre><code>FixtureExecutionResult validator = fixture
  .givenAggregate(aggregate1).published(
      GenericEventMessage.asEventMessage(new TriggerSagaStartEvent(aggregate1)), new TriggerExistingSagaEvent(aggregate1))
  .andThenAggregate(aggregate2).published(new TriggerSagaStartEvent(aggregate2))
  .whenAggregate(aggregate1).publishes(new TriggerSagaEndEvent(aggregate1))

  validator.expectActiveSagas(1)
  validator.expectAssociationWith("identifier", aggregate2)
  validator.expectNoAssociationWith("identifier", aggregate1)
  validator.expectScheduledEventOfType(Duration.ofMinutes(10), TimerTriggeredEvent::class.java)
  validator.expectScheduledEventMatching(Duration.ofMinutes(10), messageWithPayload(CoreMatchers.any(TimerTriggeredEvent::class.java)))
  validator.expectScheduledEvent(Duration.ofMinutes(10), TimerTriggeredEvent(aggregate1))
  validator.expectScheduledEventOfType(fixture.currentTime().plusSeconds(600), TimerTriggeredEvent::class.java)
  validator.expectScheduledEventMatching(fixture.currentTime().plusSeconds(600), messageWithPayload(CoreMatchers.any(TimerTriggeredEvent::class.java)))
  validator.expectScheduledEvent(fixture.currentTime().plusSeconds(600), TimerTriggeredEvent(aggregate1))
  validator.expectDispatchedCommands()
  validator.expectNoDispatchedCommands()
  validator.expectPublishedEventsMatching(noEvents())
</code></pre>
<p>translates to</p>
<pre><code>fixture {
  given {
    aggregate1 published GenericEventMessage.asEventMessage(TriggerSagaStartEvent(aggregate1)), TriggerExistingSagaEvent(aggregate1))
    aggregate2 published TriggerSagaStartEvent(aggregate2)
  }
  whenever {
    aggregate1 publishes TriggerSagaEndEvent(aggregate1)
  }
  expect {
    activeSagas(1)
    "identifier" associatedWith aggregate2
    "identifier" notAssociatedWith aggregate1
    scheduledEvent(Duration.ofMinutes(10)).ofType&lt;TimerTriggeredEvent()
    scheduledEvent(Duration.ofMinutes(10).matching(messageWithPayload(any&lt;TimerTriggeredEvent&gt;()))
    scheduledEvent(Duration.ofMinutes(10).of(TimerTriggeredEvent(aggregate1))
    dispatchedCommands {}
    noDispatchedCommands()
    publishedEventsMatching = noEvents()
  }
</code></pre>
</BODY>
</HTML>
